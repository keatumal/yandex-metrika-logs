#+title: Получение данных Яндекс Метрики через Logs API

* Описание

Это простой скрипт, который позволяет скачать неагрегированные данные Яндекс Метрики через Logs API и сохранить их в TSV формате. С официальной документацией API можно ознакомиться [[https://yandex.com/dev/metrika/ru/logs/][здесь]].

* Установка

1. Клонируйте репозиторий:

   #+begin_src sh
     git clone https://github.com/keatumal/yandex-metrika-logs.git
     cd yandex-metrika-logs
   #+end_src

2. Установите зависимости:

   С помощью Pipenv:
  
   #+begin_src
     pipenv install
   #+end_src

   Или через =pip=:
   
   #+begin_src
  pip install -r requirements.txt
  #+end_src

*  Использование

1. Создайте ~.env~ (описание ниже, пример в ~.env.example~)
2. Отредактируйте ~config.py~ (опционально, описание ниже)
3. Запустите скрипт ~get_logs.py~
   1. Через Pipenv
      #+begin_src
        pipenv shell
        python get_logs.py
      #+end_src

      Или

      #+begin_src
        pipenv run python get_logs.py
      #+end_src

   2. Или, если устанавливали через =pip=:
      #+begin_src
        python get_logs.py
      #+end_src

* Аргументы командной строки

- =-c, --counter-id= (обязательный): ID счётчика Яндекс Метрики.
- =-f, --from-date= (обязательный): дата *с* которой получать данные.
- =-t, --to-date= (обязательный): дата *до* которой получать данные (включительно). Не может быть текущим днём.
- =-o, --output-file=: имя TSV файла для сохранения полученных данных. По-умолчанию в формате =<COUNTER_ID>_<START_DATE>_<END_DATE>.tsv= в текущей директории.
- =-d, --dry-run=: только проверить возможность получения данных.
- =-h, --help=: показать справку и выйти.

* Конфигурация

Она очень проста и задаётся в файлах ~.env~ и ~config.py~.

** ~.env~

- =YM_AUTH_TOKEN=: OAuth-токен. Как получить, [[https://yandex.com/dev/metrika/ru/intro/authorization][рассказал Яндекс]].

** ~config.py~

- =WAIT_INTERVAL=: это интервал в секундах между проверками готовности отчёта.
- =FIELDS_MAP=: Поля, которые запрашиваем в отчёте. Ключом (до двоеточия) является имя поля для API, а значением (после двоеточия) его итоговое имя в файле.

  По-умолчанию сейчас там содержится большой список полей для визитов пользователей. Дополнительные можно найти в [[https://yandex.com/dev/metrika/ru/logs/fields/hits][документации]].
  
* Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле LICENSE.

* Контакты

Если у вас есть вопросы или предложения, свяжитесь со мной через Telegram: https://t.me/anakvad
